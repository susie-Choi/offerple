# Requirements Document

## Introduction

이 스펙은 Zero-Day Defense 연구 프로젝트에 CVE (Common Vulnerabilities and Exposures) 데이터 수집 및 Neo4j 그래프 데이터베이스 통합 기능을 추가하는 것을 목표로 합니다. 이를 통해 취약점 데이터의 관계형 분석이 가능해지며, Palantir Ontology와 유사한 그래프 기반 분석 경험을 쌓을 수 있습니다.

## Requirements

### Requirement 1: NVD API를 통한 CVE 데이터 수집

**User Story:** 연구자로서, NVD (National Vulnerability Database)에서 CVE 데이터를 수집하여 취약점 정보를 분석하고 싶습니다.

#### Acceptance Criteria

1. WHEN CVE ID를 제공하면 THEN 시스템은 해당 CVE의 상세 정보를 NVD API로부터 수집해야 합니다
2. WHEN 키워드 검색을 수행하면 THEN 시스템은 해당 키워드와 관련된 모든 CVE를 수집해야 합니다
3. WHEN CPE (Common Platform Enumeration)를 제공하면 THEN 시스템은 해당 제품/버전에 영향을 미치는 CVE를 수집해야 합니다
4. WHEN cutoff_date가 설정되면 THEN 시스템은 해당 날짜 이전에 공개된 CVE만 수집하여 시간적 누수를 방지해야 합니다
5. IF NVD API 키가 제공되면 THEN 시스템은 더 높은 rate limit을 활용해야 합니다
6. WHEN API rate limit에 도달하면 THEN 시스템은 적절한 대기 시간을 두고 재시도해야 합니다

### Requirement 2: CVE 데이터 구조화 및 저장

**User Story:** 연구자로서, 수집된 CVE 데이터를 구조화된 형식으로 저장하여 추후 분석에 활용하고 싶습니다.

#### Acceptance Criteria

1. WHEN CVE 데이터를 수집하면 THEN 시스템은 JSON Lines 형식으로 저장해야 합니다
2. WHEN 데이터를 저장하면 THEN 각 레코드는 source, package, collected_at, payload 필드를 포함해야 합니다
3. WHEN CVE 데이터를 저장하면 THEN CVSS 점수, 심각도, 설명, 참조 링크 등 핵심 정보가 포함되어야 합니다
4. WHEN 여러 CVE를 수집하면 THEN 각 CVE는 별도의 레코드로 저장되어야 합니다
5. WHEN 수집 중 오류가 발생하면 THEN 시스템은 오류를 로깅하고 다음 항목으로 진행해야 합니다

### Requirement 3: Neo4j 그래프 데이터베이스 통합

**User Story:** 연구자로서, CVE 데이터를 Neo4j 그래프 데이터베이스에 로드하여 취약점 간의 관계를 시각화하고 분석하고 싶습니다.

#### Acceptance Criteria

1. WHEN CVE 데이터를 로드하면 THEN 시스템은 CVE 노드를 생성하고 고유 ID로 식별해야 합니다
2. WHEN CVE를 로드하면 THEN 시스템은 영향받는 제품(CPE)과의 AFFECTS 관계를 생성해야 합니다
3. WHEN CVE를 로드하면 THEN 시스템은 관련 CWE(Common Weakness Enumeration)와의 HAS_WEAKNESS 관계를 생성해야 합니다
4. WHEN 제품 정보를 로드하면 THEN 시스템은 Vendor와 Product 노드를 생성하고 PRODUCES 관계를 설정해야 합니다
5. WHEN CVE 참조 링크를 로드하면 THEN 시스템은 Reference 노드를 생성하고 HAS_REFERENCE 관계를 설정해야 합니다
6. WHEN 데이터를 로드하기 전에 THEN 시스템은 성능 향상을 위한 uniqueness constraint를 생성해야 합니다
7. WHEN 중복 데이터를 로드하면 THEN 시스템은 MERGE를 사용하여 중복을 방지해야 합니다

### Requirement 4: 설정 기반 데이터 수집

**User Story:** 연구자로서, YAML 설정 파일을 통해 수집할 CVE 목록과 파라미터를 관리하고 싶습니다.

#### Acceptance Criteria

1. WHEN 설정 파일을 제공하면 THEN 시스템은 cutoff_date, output_dir, rate_limit 등의 파라미터를 읽어야 합니다
2. WHEN CVE 타겟 목록을 설정하면 THEN 시스템은 각 타겟에 대한 설명(description)을 메타데이터로 저장해야 합니다
3. WHEN 설정 파일에 API 키가 있으면 THEN 시스템은 해당 키를 사용해야 합니다
4. IF 환경변수로 API 키가 제공되면 THEN 시스템은 환경변수를 우선적으로 사용해야 합니다
5. WHEN 설정 파일이 유효하지 않으면 THEN 시스템은 명확한 오류 메시지를 출력해야 합니다

### Requirement 5: 명령줄 인터페이스

**User Story:** 연구자로서, 명령줄에서 간단한 명령으로 CVE 데이터를 수집하고 Neo4j에 로드하고 싶습니다.

#### Acceptance Criteria

1. WHEN collect_cve_data.py를 실행하면 THEN 시스템은 설정 파일을 읽고 CVE 데이터를 수집해야 합니다
2. WHEN 데이터 수집 중이면 THEN 시스템은 진행 상황을 progress bar로 표시해야 합니다
3. WHEN 수집이 완료되면 THEN 시스템은 수집된 CVE 수와 오류 수를 요약해야 합니다
4. WHEN load_cve_to_neo4j.py를 실행하면 THEN 시스템은 JSONL 파일을 읽고 Neo4j에 로드해야 합니다
5. WHEN Neo4j 로드 중이면 THEN 시스템은 로드된 CVE 수를 주기적으로 로깅해야 합니다
6. WHEN 명령줄 인자로 로그 레벨을 지정하면 THEN 시스템은 해당 레벨로 로깅해야 합니다
7. WHEN Neo4j 연결 정보를 인자로 제공하면 THEN 시스템은 해당 정보로 연결해야 합니다

### Requirement 6: 기존 아키텍처와의 통합

**User Story:** 개발자로서, 새로운 CVE 데이터 소스가 기존 데이터 파이프라인 아키텍처와 일관되게 통합되기를 원합니다.

#### Acceptance Criteria

1. WHEN CVE 데이터 소스를 구현하면 THEN BaseDataSource 클래스를 상속해야 합니다
2. WHEN CVE 데이터를 수집하면 THEN SourceResult 객체를 반환해야 합니다
3. WHEN HTTP 요청을 수행하면 THEN BaseDataSource의 _request 메서드를 사용해야 합니다
4. WHEN 데이터를 저장하면 THEN 기존 패키지 데이터와 동일한 JSONL 형식을 사용해야 합니다
5. WHEN 에러가 발생하면 THEN DataSourceError 예외를 발생시켜야 합니다

### Requirement 7: 문서화 및 사용 가이드

**User Story:** 연구자로서, CVE 데이터 수집 및 Neo4j 통합 기능을 쉽게 이해하고 사용할 수 있는 문서가 필요합니다.

#### Acceptance Criteria

1. WHEN 문서를 읽으면 THEN Neo4j 설치 방법이 명시되어야 합니다
2. WHEN 문서를 읽으면 THEN CVE 데이터 수집 실행 방법이 예제와 함께 제공되어야 합니다
3. WHEN 문서를 읽으면 THEN Neo4j 로드 실행 방법이 예제와 함께 제공되어야 합니다
4. WHEN 문서를 읽으면 THEN NVD API 키 발급 방법이 안내되어야 합니다
5. WHEN 문서를 읽으면 THEN Neo4j에서 실행 가능한 샘플 Cypher 쿼리가 제공되어야 합니다
6. WHEN 코드를 읽으면 THEN 각 함수와 클래스에 docstring이 포함되어야 합니다
